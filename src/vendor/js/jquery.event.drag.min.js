/*
jquery.event.drag.js ~ v1.5 ~ Copyright (c) 2008, Three Dub Media (http://threedubmedia.com)
Licensed under the MIT License ~ http://threedubmedia.googlecode.com/files/MIT-LICENSE.txt
*/
(function(a) {
    function e(h) {
        var k, j = this, l = h.data || {};
        if (l.elem)
            j = h.dragTarget = l.elem,
            h.dragProxy = d.proxy || j,
            h.cursorOffsetX = l.pageX - l.left,
            h.cursorOffsetY = l.pageY - l.top,
            h.offsetX = h.pageX - h.cursorOffsetX,
            h.offsetY = h.pageY - h.cursorOffsetY;
        else if (d.dragging || l.which > 0 && h.which != l.which || a(h.target).is(l.not))
            return;
        switch (h.type) {
        case "mousedown":
            return a.extend(l, a(j).offset(), {
                elem: j,
                target: h.target,
                pageX: h.pageX,
                pageY: h.pageY
            }),
            b.add(document, "mousemove mouseup", e, l),
            i(j, !1),
            d.dragging = null ,
            !1;
        case !d.dragging && "mousemove":
            if (g(h.pageX - l.pageX) + g(h.pageY - l.pageY) < l.distance)
                break;
            h.target = l.target,
            k = f(h, "dragstart", j),
            k !== !1 && (d.dragging = j,
            d.proxy = h.dragProxy = a(k || j)[0]);
        case "mousemove":
            if (d.dragging) {
                if (k = f(h, "drag", j),
                c.drop && (c.drop.allowed = k !== !1,
                c.drop.handler(h)),
                k !== !1)
                    break;
                h.type = "mouseup"
            }
        case "mouseup":
            b.remove(document, "mousemove mouseup", e),
            d.dragging && (c.drop && c.drop.handler(h),
            f(h, "dragend", j)),
            i(j, !0),
            d.dragging = d.proxy = l.elem = !1
        }
        return !0
    }
    function f(b, c, d) {
        b.type = c;
        var e = a.event.dispatch.call(d, b);
        return e === !1 ? !1 : e || b.result
    }
    function g(a) {
        return Math.pow(a, 2)
    }
    function h() {
        return d.dragging === !1
    }
    function i(a, b) {
        a && (a.unselectable = b ? "off" : "on",
        a.onselectstart = function() {
            return b
        }
        ,
        a.style && (a.style.MozUserSelect = b ? "" : "none"))
    }
    a.fn.drag = function(a, b, c) {
        return b && this.bind("dragstart", a),
        c && this.bind("dragend", c),
        a ? this.bind("drag", b ? b : a) : this.trigger("drag")
    }
    ;
    var b = a.event
      , c = b.special
      , d = c.drag = {
        not: ":input",
        distance: 0,
        which: 1,
        dragging: !1,
        setup: function(c) {
            c = a.extend({
                distance: d.distance,
                which: d.which,
                not: d.not
            }, c || {}),
            c.distance = g(c.distance),
            b.add(this, "mousedown", e, c),
            this.attachEvent && this.attachEvent("ondragstart", h)
        },
        teardown: function() {
            b.remove(this, "mousedown", e),
            this === d.dragging && (d.dragging = d.proxy = !1),
            i(this, !0),
            this.detachEvent && this.detachEvent("ondragstart", h)
        }
    };
    c.dragstart = c.dragend = {
        setup: function() {},
        teardown: function() {}
    }
})(jQuery);